var D=(e,t)=>t.some(r=>e instanceof r),B,p;function M(){return B||(B=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function S(){return p||(p=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var w=new WeakMap,h=new WeakMap,f=new WeakMap;function L(e){let t=new Promise((r,n)=>{let o=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{r(u(e.result)),o()},s=()=>{n(e.error),o()};e.addEventListener("success",i),e.addEventListener("error",s)});return f.set(t,e),t}function O(e){if(w.has(e))return;let t=new Promise((r,n)=>{let o=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{r(),o()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});w.set(e,t)}var g={get(e,t,r){if(e instanceof IDBTransaction){if(t==="done")return w.get(e);if(t==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return u(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function E(e){g=e(g)}function A(e){return S().includes(e)?function(...t){return e.apply(N(this),t),u(this.request)}:function(...t){return u(e.apply(N(this),t))}}function K(e){return typeof e=="function"?A(e):(e instanceof IDBTransaction&&O(e),D(e,M())?new Proxy(e,g):e)}function u(e){if(e instanceof IDBRequest)return L(e);if(h.has(e))return h.get(e);let t=K(e);return t!==e&&(h.set(e,t),f.set(t,e)),t}var N=e=>f.get(e);function I(e,t,{blocked:r,upgrade:n,blocking:o,terminated:i}={}){let s=indexedDB.open(e,t),d=u(s);return n&&s.addEventListener("upgradeneeded",c=>{n(u(s.result),c.oldVersion,c.newVersion,u(s.transaction),c)}),r&&s.addEventListener("blocked",c=>r(c.oldVersion,c.newVersion,c)),d.then(c=>{i&&c.addEventListener("close",()=>i()),o&&c.addEventListener("versionchange",l=>o(l.oldVersion,l.newVersion,l))}).catch(()=>{}),d}function V(e,{blocked:t}={}){let r=indexedDB.deleteDatabase(e);return t&&r.addEventListener("blocked",n=>t(n.oldVersion,n)),u(r).then(()=>{})}var j=["get","getKey","getAll","getAllKeys","count"],k=["put","add","delete","clear"],m=new Map;function x(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(m.get(t))return m.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,o=k.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(o||j.includes(r)))return;let i=async function(s,...d){let c=this.transaction(s,o?"readwrite":"readonly"),l=c.store;return n&&(l=l.index(d.shift())),(await Promise.all([l[r](...d),o&&c.done]))[0]};return m.set(t,i),i}E(e=>({...e,get:(t,r,n)=>x(t,r)||e.get(t,r,n),has:(t,r)=>!!x(t,r)||e.has(t,r)}));var T=["continue","continuePrimaryKey","advance"],P={},b=new WeakMap,v=new WeakMap,W={get(e,t){if(!T.includes(t))return e[t];let r=P[t];return r||(r=P[t]=function(...n){b.set(this,v.get(this)[t](...n))}),r}};async function*F(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;let r=new Proxy(t,W);for(v.set(r,t),f.set(r,N(t));t;)yield r,t=await(b.get(r)||t.continue()),b.delete(r)}function C(e,t){return t===Symbol.asyncIterator&&D(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&D(e,[IDBIndex,IDBObjectStore])}E(e=>({...e,get(t,r,n){return C(t,r)?F:e.get(t,r,n)},has(t,r){return C(t,r)||e.has(t,r)}}));var y={};async function a(e){e.version===null&&(e.version=void 0),e.keyPath??="id";try{return await I(e.databaseName,e.version,{upgrade(r){r.createObjectStore(e.storeName??e.databaseName,{keyPath:e.keyPath})}})}catch(t){return console.error(t),null}}async function z(e){let t=await a(e);if(t)try{return await t.clear(e.storeName??e.databaseName)}catch(r){console.error(r)}}async function G(e){let t=await a(e);if(!t)return 0;try{return await t.count(e.storeName??e.databaseName)}catch(r){return console.error(r),0}}async function H(e){try{await V(e)}catch(t){console.error(t)}}async function Q(e,t){let r=await a(e);if(!r)return!1;try{return await r.delete(e.storeName??e.databaseName,t),!0}catch(n){return console.error(n),!1}}async function U(e){let t=await a(e);if(!t)return[];try{return await t.getAll(e.storeName??e.databaseName)}catch(r){return console.error(r),[]}}async function X(e){let t=await a(e);if(!t)return[];try{var r=await t.getAll(e.storeName??e.databaseName);return r.map(n=>JSON.stringify(n))}catch(n){return console.error(n),[]}}async function Y(e,t){let r=await a(e);if(!r)return[];let n=e.databaseName+"."+e.storeName;t&&delete y[n];let o=y[n];if(!o||o.db.version!=e.version)try{let s=await r.transaction(e.storeName??e.databaseName).store.openCursor();o={db:e,cursor:s}}catch(s){console.error(s)}if(!o)return[];let i=[];try{for(;o.cursor&&i.length<20;)i.push(o.cursor.value),o.cursor=await o.cursor.continue()}catch(s){console.error(s)}return i}async function Z(e,t){let r=await a(e);if(!r)return[];let n=e.databaseName+"."+e.storeName;t&&delete y[n];let o=y[n];if(!o||o.db.version!=e.version)try{let s=await r.transaction(e.storeName??e.databaseName).store.openCursor();o={db:e,cursor:s}}catch(s){console.error(s)}if(!o)return[];let i=[];try{for(;o.cursor&&i.length<20;)i.push(JSON.stringify(o.cursor.value)),o.cursor=await o.cursor.continue()}catch(s){console.error(s)}return i}async function _(e,t){let r=await a(e);if(!r)return null;try{return await r.get(e.storeName??e.databaseName,t)}catch(n){return console.error(n),null}}async function q(e,t){let r=await a(e);if(!r)return null;try{return JSON.stringify(await r.get(e.storeName??e.databaseName,t))}catch(n){return console.error(n),null}}async function ee(e,t){let r=await a(e);if(!r)return!1;try{return await r.put(e.storeName??e.databaseName,JSON.parse(t)),!0}catch(n){return console.error(n),!1}}export{z as clear,G as count,H as deleteDatabase,Q as deleteValue,U as getAll,X as getAllStrings,Y as getBatch,Z as getBatchStrings,_ as getValue,q as getValueString,ee as putValue};
//# sourceMappingURL=tavenem-indexeddb.js.map
